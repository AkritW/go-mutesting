language: go

go:
  - tip

install:
  # tools
  - make tools

  # project
  - make dependencies
  - make install

script:
  # linting
  - $(exit $(gofmt -l . | wc -l))
  - errcheck github.com/zimmski/go-mutesting/...
  - $(exit $(go tool vet -all=true -v=true . 2>&1 | grep --invert-match -P "(Checking file|\%p of wrong type|can't check non-constant format|not compatible with reflect.StructTag.Get)" | wc -l))
  - $(exit $(golint ./... | grep --invert-match -P "(_string.go:)" | wc -l))

  # project
  - make testverbose

  # code coverage
  - ginkgo -r -cover -skipPackage="testdata"
  - gover
  - if [ "$TRAVIS_SECURE_ENV_VARS" = "true" ]; then goveralls -coverprofile=gover.coverprofile -service=travis-ci -repotoken $COVERALLS_TOKEN; fi

env:
  # coveralls.io
  secure: "OntYh2L1QW3VWuxKHDh5tWdWpUzIEuCVKqpjN11OOFriByT9AC1noYFq15KV30vtIyqs25fy7II5KjRrlTlawQFga0ahSG7BmFW0gfqLQWbPouAlHNVPVkf4QfTKb8Dtn1JQVB5p6egPCjE/xzZE5/mjgylsfTKRz5Y85OPfri8="
